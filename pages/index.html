<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Controladoria Balança - AW</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="/css/wilson-ui.css">
    <link rel="shortcut icon" href="/img/logo-sf.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/loading.css">
</head>
<body onclick="closeContextMenu()">
    <div id="loading-screen" class="loading-screen hidden">
        <div class="loader-wrapper">
            <div class="truck-wrapper">
                <div class="truck">
                    <div class="truck-container"></div>
                    <div class="glases"></div>
                    <div class="bonet"></div>
                    <div class="base"></div>
                    <div class="base-aux"></div>
                    <div class="wheel-back"></div>
                    <div class="wheel-front"></div>
                    <div class="smoke"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- SEGURANÇA E LOGIN (MANTIDO INLINE PARA DOCUMENT.WRITE FUNCIONAR) ---
        const loggedUser = JSON.parse(sessionStorage.getItem('loggedInUser'));
        if (!loggedUser) window.location.href = 'login.html';

        const userSector = (loggedUser.sector || '').toLowerCase();
        const userRole = (loggedUser.role || '').toLowerCase();
        const userSubType = loggedUser.subType;

        const isRecebimento = userSector === 'recebimento' || userRole === 'admin';
        const isConferente = userSector === 'conferente';
        const isAdmin = userRole === 'admin';
        
        // Atalho Reset
        let altHeld = false; let commaPressed = false;
        window.addEventListener('keydown', function(e) {
            if (e.key === 'Alt') altHeld = true;
            if (altHeld && e.key === ',') commaPressed = true;
            if (altHeld && commaPressed && e.key === '.') {
                if(confirm("RESET TOTAL?")) { localStorage.clear(); window.location.reload(); }
                altHeld = false; commaPressed = false;
            }
        });
        window.addEventListener('keyup', function(e) { if (e.key === 'Alt') { altHeld = false; commaPressed = false; } });
    </script>

    <div class="mobile-header-bar">
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
        <div style="font-weight:bold; font-size:1.2rem;">AW CONTROLADORIA</div>
        <button onclick="logout()" style="background:none; border:none; color:white;"><i class="fas fa-sign-out-alt"></i></button>
    </div>

    <nav class="main-sidebar">
        <div class="logo-area"><img src="/img/logo-sf.png" alt="logo" style="width: 50px; height: 50px;"><span style="margin-left:10px">CONTROLADORIA</span></div>
        <div class="menu-items">
            <a class="menu-item active" id="menuPatio" onclick="navTo('patio', this)"><i class="fas fa-truck"></i> Controle de Pátio</a>
            <a class="menu-item" onclick="navTo('mapas', this)"><i class="fas fa-clipboard-list"></i> Mapas Cegos</a>
            <a class="menu-item" id="menuMateriaPrima" onclick="navTo('materia-prima', this)" style="display:none;"><i class="fas fa-truck-loading"></i> Matéria Prima</a>
            <a class="menu-item" id="menuCarregamento" onclick="navTo('carregamento', this)"><i class="fas fa-shipping-fast"></i> Carregamento</a>
            <a class="menu-item" onclick="navTo('relatorios', this)"><i class="fas fa-chart-bar"></i> Relatórios</a>
            <a class="menu-item" id="menuNotif" onclick="navTo('notificacoes', this)"><i class="fas fa-bell"></i> Notificações <span class="notification-badge" id="badgeNotif">0</span></a>
            <div style="margin-top:auto; padding:20px;">
                <a class="menu-item" onclick="navTo('configuracoes', this)">
                    <i class="fas fa-cog"></i> Configurações
                </a>
            </div>
        </div>
        <div class="user-footer" onclick="window.location.href='perfil.html'">
            <div style="width:30px; height:30px; background:red; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;"><script>document.write(loggedUser.username[0])</script></div>
            <div><div style="font-size:0.9rem; font-weight:bold;"><script>document.write(loggedUser.username)</script></div><div style="font-size:0.75rem; opacity:0.7;"><script>document.write(loggedUser.label || loggedUser.sector)</script></div></div>
        </div>
    </nav>

    <main class="content-area">
        <header class="top-header">
            <h2 id="pageTitle" style="margin:0; font-size:1.2rem; color:#333;">Painel de Pátio</h2>
            <button onclick="logout()" style="border:none; background:#eee; padding:8px 15px; border-radius:4px; cursor:pointer;"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </header>

        <div id="view-patio" class="view-section active">
            <div style="display:flex; justify-content:flex-end; margin-bottom:15px;">
                <input type="date" id="patioDateFilter" onchange="renderPatio()" style="padding:8px; border:1px solid #ccc; border-radius:4px;">
            </div>
            <div class="board-container">
                <div class="board-col" id="col-ALM"><div class="col-header col-alm">DOCA (ALM) <span id="count-ALM">0</span></div><div class="col-body" id="list-ALM"></div></div>
                <div class="board-col" id="col-GAVA"><div class="col-header col-gava">GAVA (ALM) <span id="count-GAVA">0</span></div><div class="col-body" id="list-GAVA"></div></div>
                <div class="board-col" id="col-OUT"><div class="col-header col-out">OUTROS <span id="count-OUT">0</span></div><div class="col-body" id="list-OUT"></div></div>
                <div class="board-col" id="col-SAIU"><div class="col-header col-saiu">HISTÓRICO (DIA)</div><div class="col-body" id="list-SAIU"></div></div>
            </div>
            <div id="fabAddTruck" class="fab" onclick="modalTruckOpen()">+</div>
        </div>

        <div id="view-mapas" class="view-section">
            <div class="mc-layout">
                <div class="mobile-map-toggle" onclick="toggleMapListMobile()">Ver Lista de Mapas <i class="fas fa-chevron-down"></i></div>
                
                <div class="mc-sidebar-list" id="mobileMapList">
                    <div class="mc-list-header">
                        Mapas Cegos
                        <input type="date" id="mapListDateFilter" onchange="renderMapList()" style="width:100%; margin-top:8px; padding:8px; border:1px solid #ccc; border-radius:4px; box-sizing:border-box;">
                    </div>
                    <div class="mc-list-items" id="mapList"></div>
                    <button onclick="createNewMap()" style="padding:10px; background:#333; color:white; border:none; cursor:pointer; width:100%;">+ Novo Mapa Manual</button>
                </div>

                <div style="flex:1; overflow-y:auto;">
                    <div class="sheet" id="mapSheet">
                        <div id="divBanner" class="divergence-banner" style="display:none;">
                            <i class="fas fa-exclamation-triangle"></i> <b>MAPA COM DIVERGÊNCIA</b><br>
                            <span id="divBannerText" style="font-size:0.9rem;"></span>
                            <div style="margin-top:5px;" id="divResolveBtn"></div>
                        </div>

                        <div class="sheet-header">
                            <img src="https://www.alimentoswilson.com.br/imgs/logo-wilson.png" alt="Logo" class="logo-img" />
                            <div class="title">RECEBIMENTO DIÁRIO DE MATERIAIS — MAPA CEGO DIGITAL</div>
                            <div class="date-wrap">Dia: <input type="date" id="mapDate"></div>
                        </div>
                        
                        <div class="table-responsive-wrapper">
                            <table class="mc-table">
                                <thead>
                                    <tr>
                                        <th style="min-width:200px;">Descrição dos Materiais</th>
                                        <th style="width:80px;">Qtd.</th>
                                        <th style="width:100px;">Nota Fiscal</th>
                                        <th style="min-width:150px;">Fornecedor</th>
                                    </tr>
                                </thead>
                                <tbody id="mapBody"></tbody>
                            </table>
                        </div>

                        <div class="controls">
                            <button class="btn btn-save" onclick="saveCurrentMap()">Salvar</button>
                            <button class="btn btn-launch" onclick="launchMap()" id="btnLaunch">Lançar Definitivo</button>
                            <button class="btn btn-request" id="btnRequestEdit" style="display:none;" onclick="triggerRequest('edit')">Solicitar Edição (Bloqueado)</button>
                            <div id="mapStatus" class="status status-open">Rascunho</div>
                        </div>
                        
                        <div class="extras">
                            <div class="card-extra">
                                <label style="font-weight:bold;">Setor de Entrega:</label>
                                <input type="text" id="mapSetor" class="cell" style="width:150px; border-bottom:1px solid #ccc; background:#f9f9f9;" placeholder="Digite o setor...">
                            </div>
                            <div class="card-extra">Placa: <input id="mapPlaca" class="cell" type="text" style="width:100px; margin: 10px; border-bottom:1px solid #ccc;"></div>
                            <div class="card-extra sig-area" style="margin-left:auto; display:flex; gap:10px;">
                                <div><button onclick="signMap('receb')" class="btn-sig" style="cursor:pointer; font-size:11px;">Ass. Recebimento</button><div id="sigReceb" class="sig-text" style="color:blue; font-weight:bold;"></div></div>
                                <div><button onclick="signMap('conf')" class="btn-sig" style="cursor:pointer; font-size:11px;">Ass. Conferente</button><div id="sigConf" class="sig-text" style="color:red; font-weight:bold;"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-materia-prima" class="view-section">
            <div style="background:white; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); min-width:1200px; overflow-x:auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="color:var(--wilson-red); display:flex; align-items:center; gap:10px;"><i class="fas fa-truck-loading"></i> Controle de Pesagem (Matéria Prima)</h2>
                    <div><input type="date" id="mpDateFilter" onchange="renderMateriaPrima()" style="padding:8px; border:1px solid #ccc; border-radius:4px;"></div>
                </div>
                <table class="mc-table">
                    <thead><tr><th class="mp-header">Data</th><th class="mp-header">Matéria Prima</th><th class="mp-header">Placa</th><th class="mp-header">Local</th><th class="mp-header">Chegada</th><th class="mp-header">Entrada</th><th class="mp-header">Tara (Kg)</th><th class="mp-header">Bruto (Kg)</th><th class="mp-header">Líquido (Kg)</th><th class="mp-header">Peso NF (Kg)</th><th class="mp-header">DIF (Kg)</th><th class="mp-header">DIF (%)</th><th class="mp-header">Saída</th><th class="mp-header">NF</th></tr></thead>
                    <tbody id="mpBody"></tbody>
                </table>
            </div>
        </div>

        <div id="view-carregamento" class="view-section">
             <div style="background:white; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); min-width:1200px; overflow-x:auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="color:#000; display:flex; align-items:center; gap:10px;"><i class="fas fa-shipping-fast"></i> Controle de Carregamento (Expedição)</h2>
                    <div><input type="date" id="carrDateFilter" onchange="renderCarregamento()" style="padding:8px; border:1px solid #ccc; border-radius:4px;"></div>
                </div>
                <table class="mc-table">
                    <thead>
                        <tr>
                            <th style="background:#333; color:white;">Status</th>
                            <th style="background:#333; color:white;">Motorista</th>
                            <th style="background:#333; color:white;">Placa Cavalo</th>
                            <th style="background:#333; color:white;">Carreta(s)</th>
                            <th style="background:#333; color:white;">Tara (Kg)</th>
                            <th style="background:#333; color:white;">Bruto (Kg)</th>
                            <th style="background:#333; color:white;">Líquido (Kg)</th>
                            <th style="background:#333; color:white;">Chegada</th>
                            <th style="background:#333; color:white;">Início Carreg.</th>
                            <th style="background:#333; color:white;">Fim / Saída</th>
                            <th style="background:#333; color:white;">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="carrBody"></tbody>
                </table>
            </div>
            <div class="fab" onclick="openModalCarregamento()" style="background:#333;">+</div>
        </div>

        <div id="view-relatorios" class="view-section">
            <div style="background:white; padding:20px; border-radius:8px; max-width:800px; margin:0 auto;">
                <h3>Relatórios Diários</h3>
                <div style="display:flex; gap:20px; margin-bottom:20px; flex-wrap:wrap;">
                    <div><label>Data:</label><input type="date" id="repDate" style="padding:8px; border:1px solid #ccc; border-radius:4px;"></div>
                    <div><label>Tipo:</label><select id="repType" style="padding:8px; border:1px solid #ccc; border-radius:4px;"><option value="patio">Fila de Caminhões</option><option value="mapas">Mapas Cegos Lançados</option><option value="carregamento">Carregamento</option></select></div>
                    <button class="btn btn-save" onclick="generateReport()">Gerar Relatório</button>
                </div>
                <div id="repResult" style="border-top:1px solid #eee; padding-top:20px;"><p style="text-align:center; color:#999; margin-top:30px;">Selecione os filtros e clique em Gerar.</p></div>
            </div>
        </div>

        <div id="view-notificacoes" class="view-section">
            <div class="req-container">
                <div class="req-col"><div class="req-title"><i class="fas fa-exclamation-circle"></i> Pendentes / Ação Necessária</div><div id="reqList"><p style="color:#666">Nenhuma solicitação pendente.</p></div></div>
                <div class="req-col"><div class="req-title" style="color:#333; border-color:#ccc;"><i class="fas fa-history"></i> Histórico de Atividades</div><div id="historyList"></div></div>
            </div>
        </div>

        <div id="view-configuracoes" class="view-section">
            <div style="background:white; padding:20px; border-radius:8px; max-width:600px; margin:0 auto; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h3 style="color:#333; border-bottom:1px solid #eee; padding-bottom:10px;">Configurações do Sistema</h3>
                
                <div style="margin-top:20px;">
                    <h4 style="margin-bottom:10px; color:var(--wilson-red);"><i class="fas fa-bell"></i> Notificações do Windows</h4>
                    <p style="color:#666; font-size:0.9rem; margin-bottom:15px;">
                        Para receber avisos quando o navegador estiver minimizado, você precisa autorizar o acesso.
                    </p>
                    
                    <div style="display:flex; align-items:center; gap:15px; background:#f9f9f9; padding:15px; border-radius:6px; border:1px solid #eee;">
                        <div id="permStatus" style="font-weight:bold; color:#555;">Status: Verificando...</div>
                        <button class="btn btn-save" onclick="manualRequestPermission()">ATIVAR NOTIFICAÇÕES</button>
                        <button class="btn btn-edit" onclick="testNotification()">TESTAR</button>
                    </div>
                </div>
        
                <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
                    <h4 style="margin-bottom:10px;"><i class="fas fa-volume-up"></i> Teste de Som</h4>
                    <button class="btn btn-launch" onclick="playBeep()">TOCAR BIP</button>
                </div>
            </div>
        </div>
    </main>


    <div id="modalTruck" class="modal-overlay">
        <div class="modal-box">
            <h3>Entrada de Veículo</h3>
            <div style="margin-bottom:15px;"><label style="display:block; font-weight:bold;">Empresa / Transportadora</label><input type="text" id="addEmpresa" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;"></div>
            <div style="margin-bottom:15px;"><label style="display:block; font-weight:bold;">Placa do Veículo</label><input type="text" id="addPlaca" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; text-transform:uppercase;"></div>
            <div style="margin-bottom:15px;"><label style="display:block; font-weight:bold;">Destino / Setor</label><select id="addDestino" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;"><option value="DOCA">DOCA (ALMOXARIFADO)</option><option value="GAVA">GAVA (ALMOXARIFADO)</option><option value="MANUTENCAO">MANUTENÇÃO</option><option value="INFRA">INFRAESTRUTURA</option><option value="PESAGEM">SALA DE PESAGEM</option><option value="LAB">LABORATÓRIO</option><option value="SST">SST (SEGURANÇA)</option></select></div>
            <div style="margin-bottom:15px; background:#ffebee; padding:10px; border-radius:4px; border:1px solid #ffcdd2;"><label style="font-weight:bold; color:#b71c1c; display:flex; align-items:center; gap:10px; cursor:pointer;"><input type="checkbox" id="chkBalan" style="width:20px; height:20px;"><i class="fas fa-weight"></i> Enviar para Pesagem (Balança)?</label></div>
            <div style="margin-bottom:15px; background:#e3f2fd; padding:10px; border-radius:4px; border:1px solid #90caf9;">
                <label style="font-weight:bold; color:#0d47a1; display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="chkLaudo" style="width:20px; height:20px;">
                    <i class="fas fa-file-alt"></i> Com Laudo
                </label>
            </div>
            <div style="background:#f9f9f9; padding:10px; border:1px solid #eee; border-radius:4px;">
                <label style="font-weight:bold;">Produtos / Notas</label>
                <div style="display:flex; gap:5px; margin-top:5px; align-items:center;"><input type="text" id="tmpNF" placeholder="NF" style="width:25%"><input type="text" id="tmpProd" placeholder="Produto" style="width:45%"><button onclick="openProdSelect()" style="width:30px; cursor:pointer; background:#555; color:white; border:none; border-radius:4px;" title="Buscar Produto">+</button><button onclick="addTmpItem()" style="width:20%; cursor:pointer; background:#333; color:white; border:none;">ADD</button></div>
                <ul id="tmpList" style="list-style:none; padding:0; margin-top:10px; font-size:0.85rem;"></ul>
            </div>
            <div style="margin-top:20px; text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalTruck').style.display='none'">Cancelar</button><button class="btn btn-save" onclick="saveTruckAndMap()">Salvar Entrada</button></div>
        </div>
    </div>

    <div id="modalCarregamento" class="modal-overlay">
        <div class="modal-box">
            <h3>Novo Carregamento</h3>
            <div style="margin-bottom:15px;"><label style="display:block; font-weight:bold;">Nome Motorista</label><input type="text" id="carrMotorista" style="width:100%; padding:8px; border:1px solid #ccc;"></div>
            <div style="margin-bottom:15px;"><label style="display:block; font-weight:bold;">Placa Cavalo</label><input type="text" id="carrCavalo" style="width:100%; padding:8px; border:1px solid #ccc;"></div>
            <div id="carretaContainer"><div style="margin-bottom:10px;"><label style="display:block; font-weight:bold;">Placa Carreta 1</label><input type="text" class="carrCarretaInput" style="width:100%; padding:8px; border:1px solid #ccc;"></div></div>
            <button onclick="addCarretaField()" class="btn btn-edit" style="width:100%; margin-bottom:15px;">+ Adicionar Carreta</button>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalCarregamento').style.display='none'">Cancelar</button><button class="btn btn-save" onclick="saveCarregamento()">Salvar</button></div>
        </div>
    </div>

    <div id="modalProductSelect" class="modal-overlay" style="z-index:2200;">
        <div class="modal-box">
            <h3>Selecionar Produto</h3>
            <input type="text" id="prodSearch" onkeyup="filterProducts()" placeholder="Buscar produto..." style="width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc;">
            <div id="prodList" style="max-height:300px; overflow-y:auto; border:1px solid #eee;"></div>
            <div style="text-align:right; margin-top:10px;"><button class="btn btn-edit" onclick="document.getElementById('modalProductSelect').style.display='none'">Fechar</button></div>
        </div>
    </div>

    <div id="modalEditMP" class="modal-overlay">
        <div class="modal-box">
            <h3>Editar Dados</h3>
            <input type="hidden" id="editMPId">
            <div style="margin-bottom:10px;"><label>Campo 1 (Empresa/Motorista):</label><input type="text" id="editMPEmpresa" style="width:100%; padding:8px;"></div>
            <div style="margin-bottom:10px;"><label>Campo 2 (Placa/Cavalo):</label><input type="text" id="editMPPlaca" style="width:100%; padding:8px;"></div>
            <div style="margin-bottom:10px;"><label>Campo 3 (Produto):</label><input type="text" id="editMPProduto" style="width:100%; padding:8px;"></div>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalEditMP').style.display='none'">Cancelar</button><button class="btn btn-save" onclick="saveEditMP()">Salvar Alterações</button></div>
        </div>
    </div>

    <div id="modalEditCarr" class="modal-overlay">
        <div class="modal-box">
            <h3>Editar Carregamento</h3>
            <input type="hidden" id="editCarrId">
            <div style="margin-bottom:10px;"><label>Motorista:</label><input type="text" id="editCarrMot" style="width:100%; padding:8px;"></div>
            <div style="margin-bottom:10px;"><label>Placa Cavalo:</label><input type="text" id="editCarrCav" style="width:100%; padding:8px;"></div>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalEditCarr').style.display='none'">Cancelar</button><button class="btn btn-save" onclick="saveEditCarr()">Salvar</button></div>
        </div>
    </div>

    <div id="modalNoteMP" class="modal-overlay">
        <div class="modal-box">
            <h3>Observação</h3>
            <input type="hidden" id="noteMPId">
            <textarea id="noteMPText" style="width:100%; height:100px; padding:8px; margin-bottom:10px;"></textarea>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalNoteMP').style.display='none'">Fechar</button><button class="btn btn-save" onclick="saveNoteMP()">Salvar Observação</button></div>
        </div>
    </div>

    <div id="modalNoteCarr" class="modal-overlay">
        <div class="modal-box">
            <h3>Observação (Carregamento)</h3>
            <input type="hidden" id="noteCarrId">
            <textarea id="noteCarrText" style="width:100%; height:100px; padding:8px; margin-bottom:10px;"></textarea>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalNoteCarr').style.display='none'">Fechar</button><button class="btn btn-save" onclick="saveNoteCarr()">Salvar</button></div>
        </div>
    </div>

    <div id="modalTruckPreview" class="modal-overlay">
        <div class="modal-box"><h3 id="prevTTitle">Detalhes do Caminhão</h3><div id="prevTContent" style="line-height:1.6;"></div><div style="text-align:right; margin-top:15px;"><button class="btn btn-edit" onclick="document.getElementById('modalTruckPreview').style.display='none'">Fechar</button></div></div>
    </div>

    <div id="modalDivergence" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#b71c1c;"><i class="fas fa-exclamation-triangle"></i> Relatar Divergência</h3>
            <div style="margin-bottom:15px;"><label>Onde está a divergência?</label><select id="divArea" style="width:100%; padding:8px;"><option value="geral">Geral (Todo o Mapa)</option><option value="desc">Descrição dos Materiais</option><option value="qty">Quantidades</option><option value="nf">Nota Fiscal</option><option value="forn">Fornecedor</option></select></div>
            <div style="margin-bottom:15px;"><label>Descreva o problema:</label><textarea id="divReason" style="width:100%; height:80px; padding:8px;"></textarea></div>
            <div style="margin-bottom:15px;"><label>Quem deve ser avisado?</label><div class="user-select-list" id="divUserList"></div></div>
            <div style="text-align:right;"><button class="btn btn-edit" onclick="document.getElementById('modalDivergence').style.display='none'">Cancelar</button><button class="btn btn-launch" onclick="submitDivergence()">AVISAR (DIVERGÊNCIA)</button></div>
        </div>
    </div>

    <div id="modalReportPreview" class="modal-overlay">
        <div class="modal-box large"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"><h3 style="margin:0">Visualização do Mapa Cego</h3><button onclick="document.getElementById('modalReportPreview').style.display='none'" style="border:none; background:none; font-size:1.2rem; cursor:pointer;">&times;</button></div><div class="sheet" style="box-shadow:none; border:1px solid #eee;"><div class="sheet-header"><img src="https://www.alimentoswilson.com.br/imgs/logo-wilson.png" alt="Logo" class="logo-img" /><div class="title" style="font-size:14px;">MAPA CEGO - MODO VISUALIZAÇÃO</div><div class="date-wrap" id="prevDate"></div></div><div style="margin-bottom:10px; font-weight:bold; color:#555;" id="prevInfo"></div><table class="mc-table"><thead><tr><th>Descrição</th><th>Qtd. Recebida</th><th>NF</th><th>Fornecedor</th></tr></thead><tbody id="prevBody"></tbody></table><div style="margin-top:20px; display:flex; justify-content:space-between; background:#f9f9f9; padding:10px; border-radius:4px;"><div><b>Recebimento:</b> <span id="prevSigRec"></span></div><div><b>Conferente:</b> <span id="prevSigConf"></span></div></div></div><div style="text-align:right; margin-top:15px;"><button class="btn btn-edit" onclick="document.getElementById('modalReportPreview').style.display='none'">Fechar Visualização</button></div></div>
    </div>

    <div id="modalNotification" class="modal-overlay" style="z-index: 6000;">
        <div class="modal-box notification-popup" id="notifPopupContent"></div>
    </div>

    <div id="ctxMenu" class="context-menu"></div>
    <div id="ctxMenuMP" class="context-menu"></div>
    <div id="ctxMenuTruck" class="context-menu"></div>
    <div id="ctxMenuCarr" class="context-menu"></div>


    <div id="modalEditTruck" class="modal-overlay">
        <div class="modal-box">
            <h3>Editar Veículo na Fila</h3>
            <input type="hidden" id="editTruckId">
            
            <div style="margin-bottom:15px;">
                <label style="display:block; font-weight:bold;">Placa do Veículo</label>
                <input type="text" id="editTruckPlaca" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; text-transform:uppercase;">
            </div>
    
            <div style="margin-bottom:15px; background:#e3f2fd; padding:10px; border-radius:4px; border:1px solid #90caf9;">
                <label style="font-weight:bold; color:#0d47a1; display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="editTruckLaudo" style="width:20px; height:20px;">
                    <i class="fas fa-file-alt"></i> Com Laudo Técnico?
                </label>
            </div>
    
            <div style="background:#f9f9f9; padding:10px; border:1px solid #eee; border-radius:4px;">
                <label style="font-weight:bold;">Editar Produtos / Notas</label>
                <div style="display:flex; gap:5px; margin-top:5px; align-items:center;">
                    <input type="text" id="editTmpNF" placeholder="NF" style="width:25%">
                    <input type="text" id="editTmpProd" placeholder="Produto" style="width:45%">
                    <button onclick="openProdSelectForEdit()" style="width:30px; cursor:pointer; background:#555; color:white; border:none; border-radius:4px;" title="Buscar">+</button>
                    <button onclick="addEditTmpItem()" style="width:20%; cursor:pointer; background:#333; color:white; border:none;">ADD</button>
                </div>
                <ul id="editTmpList" style="list-style:none; padding:0; margin-top:10px; font-size:0.85rem;"></ul>
            </div>
    
            <div style="margin-top:20px; text-align:right;">
                <button class="btn btn-edit" onclick="document.getElementById('modalEditTruck').style.display='none'">Cancelar</button>
                <button class="btn btn-save" onclick="saveEditTruck()">Salvar Alterações</button>
            </div>
        </div>
    </div>

    
    <script src="/js/wilson-core.js"></script>
    <script>
        function showLoading() {
            document.getElementById("loading-screen").classList.remove("hidden");
        }
        
        function hideLoading() {
            document.getElementById("loading-screen").classList.add("hidden");
        }
        
        /* Exemplo: abre o loading por 3 segundos ao carregar a página */
        window.onload = () => {
            showLoading();
            setTimeout(hideLoading, 1500);
        };
        showLoading();

        </script>
        
</body>
</html>