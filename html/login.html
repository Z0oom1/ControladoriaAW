<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - WilsonUI</title>
<link rel="stylesheet" href="css/wilson-ui.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
  /* Login específico */
  body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f4f4f4; position: relative; overflow: hidden; }
  body::after { content: ''; position: absolute; width: 120%; height: 120%; background: radial-gradient(circle, rgba(211, 47, 47, 0.05), transparent 70%); z-index: -1; }
  .login-card { width: 380px; text-align: center; border-top: 5px solid var(--w-primary); }
</style>
</head>
<body>

<div class="w-card login-card">
  <h1 style="color:var(--w-primary); margin:0; letter-spacing:1px;">WILSON</h1> 
  <p style="color:#666; margin-top:5px;">Controle de Fila & Recebimento</p>
  <br>
  
  <input type="text" id="loginUser" class="w-input" placeholder="Usuário" style="margin-bottom:15px;">
  <input type="password" id="loginPass" class="w-input" placeholder="Senha" style="margin-bottom:20px;">
  <button onclick="fazerLogin()" class="w-btn w-btn-primary" style="width:100%; justify-content:center;">ENTRAR</button>
  
  <div style="margin-top:20px; font-size:0.85rem;">
    <a onclick="abrirRegistro()" style="color:var(--w-primary); cursor:pointer;">Solicitar Acesso</a>
  </div>
</div>

<div id="modalRegistro" class="w-modal-overlay">
  <div class="w-modal">
    <h3>Solicitar Novo Acesso</h3>
    <form id="formRegistro" style="display:grid; gap:15px;">
      <input type="text" id="regNome" class="w-input" placeholder="Nome Completo" required>
      <input type="text" id="regUser" class="w-input" placeholder="Usuário Desejado" required>
      <input type="password" id="regPass" class="w-input" placeholder="Senha" required>
      <select id="regSetor" class="w-select">
        <option value="recebimento">Recebimento</option>
        <option value="conferente">Conferente</option>
        <option value="admin">Administração</option>
      </select>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button type="button" onclick="fecharRegistro()" class="w-btn w-btn-outline">Cancelar</button>
        <button type="submit" class="w-btn w-btn-primary">Solicitar</button>
      </div>
    </form>
  </div>
</div>

<div class="w-btn w-btn-dark" onclick="abrirSwitcher()" style="position:fixed; bottom:20px; left:20px; border-radius:50%; width:50px; height:50px; padding:0; justify-content:center;" title="Contas Rápidas">
    <i class="fas fa-users"></i>
</div>

<div id="modalSwitcher" class="w-modal-overlay">
    <div class="w-modal" style="width:350px;">
        <h3>Selecionar Conta Teste</h3>
        <div id="listaContas" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
        <button onclick="document.getElementById('modalSwitcher').style.display='none'" class="w-btn w-btn-outline" style="width:100%">Fechar</button>
    </div>
</div>

<script>
    const USERS_KEY = 'mapa_cego_users';
    if (!localStorage.getItem(USERS_KEY)) {
        const defaultUsers = [
            { username: 'admin', password: '123', role: 'admin', sector: 'admin' },
            { username: 'Balanca', password: '123', role: 'user', sector: 'recebimento' }
        ];
        localStorage.setItem(USERS_KEY, JSON.stringify(defaultUsers));
    }
    const testAccounts = [
        { username: 'Fabricio', sector: 'conferente', subType: 'ALM', role: 'user', label: 'Conferente - ALMOXARIFADO' },
        { username: 'Clodoaldo', sector: 'conferente', subType: 'ALM', role: 'user', label: 'Conferente - ALMOXARIFADO' },
        { username: 'Guilherme', sector: 'conferente', subType: 'GAVA', role: 'user', label: 'Conferente - GAVA' },
        { username: 'Outros', sector: 'conferente', subType: 'OUT', role: 'user', label: 'Conferente - OUTROS' },
        { username: 'Caio', sector: 'recebimento', subType: null, role: 'user', label: 'Recebimento - Caio' },
        { username: 'Balanca', sector: 'recebimento', subType: null, role: 'user', label: 'Recebimento - Balança' },
        { username: 'Admin', sector: 'recebimento', subType: null, role: 'admin', label: 'Administrador / Geral' }
    ];

    function fazerLogin() {
        const userIn = document.getElementById('loginUser').value;
        const passIn = document.getElementById('loginPass').value;
        const users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
        const user = users.find(u => u.username === userIn && u.password === passIn);
        if (user) loginComUsuario(user);
        else alert("Usuário ou senha incorretos.");
    }

    function loginComUsuario(user) {
        sessionStorage.setItem('loggedInUser', JSON.stringify(user));
        // Redireciona para o painel principal se for user, ou admin se for admin (opcional, mantendo padrão user)
        window.location.href = user.role === 'admin' ? 'admin.html' : 'CONTROLADORIA_BALANCA.html';
    }

    function abrirSwitcher() {
        const lista = document.getElementById('listaContas');
        lista.innerHTML = '';
        testAccounts.forEach(acc => {
            const item = document.createElement('div');
            item.style.padding = '10px'; item.style.borderBottom = '1px solid #eee'; item.style.cursor = 'pointer'; item.style.display = 'flex'; item.style.alignItems = 'center'; item.style.gap = '10px';
            item.innerHTML = `<div style="width:30px; height:30px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${acc.username[0]}</div><div><div>${acc.username}</div><small style="color:#666">${acc.label}</small></div>`;
            item.onclick = () => loginComUsuario(acc);
            lista.appendChild(item);
        });
        document.getElementById('modalSwitcher').style.display = 'flex';
    }

    function abrirRegistro() { document.getElementById('modalRegistro').style.display = 'flex'; }
    function fecharRegistro() { document.getElementById('modalRegistro').style.display = 'none'; }

    document.getElementById('formRegistro').addEventListener('submit', (e) => {
        e.preventDefault();
        const requests = JSON.parse(localStorage.getItem('register_requests') || '[]');
        requests.push({
            id: Date.now(), fullName: document.getElementById('regNome').value, desiredUsername: document.getElementById('regUser').value, 
            desiredPassword: document.getElementById('regPass').value, sector: document.getElementById('regSetor').value, status: 'pending', requestDate: new Date().toISOString()
        });
        localStorage.setItem('register_requests', JSON.stringify(requests));
        alert("Solicitação enviada.");
        fecharRegistro();
    });
</script>
</body>
</html>